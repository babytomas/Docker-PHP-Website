# PHP Dockerfile
# VERSION 1.0.0
# Author: Cheuknang Chiang

# Base on offcial php-fpm
FROM php:${VERSION:-7.2}-fpm
MAINTAINER Cheuknang Chiang <mail@cheuknang.cn>

# Copy init scripts
COPY scripts /home/init-scripts

# Run the init script
RUN /bin/bash /home/init-scripts/init.sh

# Backup php configuration
RUN cp /usr/local/etc/php /usr/local/etc/php_bak -a

# Copy php.ini
RUN cp /usr/local/etc/php/php.ini-production /usr/local/etc/php/php.ini

# Install PDO MySQLi and Fileinfo
#RUN docker-php-ext-install pdo pdo_mysql mysqli fileinfo

# Install IonCube
ADD scripts/php/ioncube_loaders_lin_x86-64.tar.gz /usr/local/etc/php/
RUN /bin/bash /home/init-scripts/php/install_ioncube.sh $VERSION

# Install Composer
# ...

# Other operation
# ...

# Remove scripts
RUN rm -rf /home/init-scripts
